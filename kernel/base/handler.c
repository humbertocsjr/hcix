#include <hcix.h>
/*
#pragma pack(1)

#define IDT_MAX 256

typedef struct idtr_t
{
    uint16_t offset_low;
    uint16_t selector;
    uint16_t flags;
    uint16_t offset_high;
} idtr_t;

static idtr_t *_idt;

#define INT(id) extern void handler_idt_##id(); _idt[id].offset_low = ((size_t)handler_idt_##id & 0xffff); _idt[id].offset_high = ((size_t)handler_idt_##id & 0xffff) _idt[id].selector = 0x8; _idt[id].flags = 0x8e00;
#define TRP(id) extern void handler_idt_##id(); _idt[id].offset_low = ((size_t)handler_idt_##id & 0xffff); _idt[id].offset_high = ((size_t)handler_idt_##id & 0xffff) _idt[id].selector = 0x8; _idt[id].flags = 0x8f00;

void handler_register()
{
    _idt = memmgr_alloc(sizeof(idtr_t) * IDT_MAX);
    TRP(0x00);
    TRP(0x01);
    INT(0x02);
    TRP(0x03);
    TRP(0x04);
    TRP(0x05);
    TRP(0x06);
    INT(0x07);
    INT(0x08);
    INT(0x09);
    INT(0x0a);
    INT(0x0b);
    INT(0x0c);
    INT(0x0d);
    INT(0x0e);
    INT(0x0f);
    INT(0x10);
    INT(0x11);
    INT(0x12);
    INT(0x13);
    INT(0x14);
    INT(0x15);
    INT(0x16);
    INT(0x17);
    INT(0x18);
    INT(0x19);
    INT(0x1a);
    INT(0x1b);
    INT(0x1c);
    INT(0x1d);
    INT(0x1e);
    INT(0x1f);
    INT(0x20);
    INT(0x21);
    INT(0x22);
    INT(0x23);
    INT(0x24);
    INT(0x25);
    INT(0x26);
    INT(0x27);
    INT(0x28);
    INT(0x29);
    INT(0x2a);
    INT(0x2b);
    INT(0x2c);
    INT(0x2d);
    INT(0x2e);
    INT(0x2f);
    INT(0x30);
    INT(0x31);
    INT(0x32);
    INT(0x33);
    INT(0x34);
    INT(0x35);
    INT(0x36);
    INT(0x37);
    INT(0x38);
    INT(0x39);
    INT(0x3a);
    INT(0x3b);
    INT(0x3c);
    INT(0x3d);
    INT(0x3e);
    INT(0x3f);
    INT(0x40);
    INT(0x41);
    INT(0x42);
    INT(0x43);
    INT(0x44);
    INT(0x45);
    INT(0x46);
    INT(0x47);
    INT(0x48);
    INT(0x49);
    INT(0x4a);
    INT(0x4b);
    INT(0x4c);
    INT(0x4d);
    INT(0x4e);
    INT(0x4f);
    INT(0x50);
    INT(0x51);
    INT(0x52);
    INT(0x53);
    INT(0x54);
    INT(0x55);
    INT(0x56);
    INT(0x57);
    INT(0x58);
    INT(0x59);
    INT(0x5a);
    INT(0x5b);
    INT(0x5c);
    INT(0x5d);
    INT(0x5e);
    INT(0x5f);
    INT(0x60);
    INT(0x61);
    INT(0x62);
    INT(0x63);
    INT(0x64);
    INT(0x65);
    INT(0x66);
    INT(0x67);
    INT(0x68);
    INT(0x69);
    INT(0x6a);
    INT(0x6b);
    INT(0x6c);
    INT(0x6d);
    INT(0x6e);
    INT(0x6f);
    INT(0x70);
    INT(0x71);
    INT(0x72);
    INT(0x73);
    INT(0x74);
    INT(0x75);
    INT(0x76);
    INT(0x77);
    INT(0x78);
    INT(0x79);
    INT(0x7a);
    INT(0x7b);
    INT(0x7c);
    INT(0x7d);
    INT(0x7e);
    INT(0x7f);
    INT(0x80);
    INT(0x81);
    INT(0x82);
    INT(0x83);
    INT(0x84);
    INT(0x85);
    INT(0x86);
    INT(0x87);
    INT(0x88);
    INT(0x89);
    INT(0x8a);
    INT(0x8b);
    INT(0x8c);
    INT(0x8d);
    INT(0x8e);
    INT(0x8f);
    INT(0x90);
    INT(0x91);
    INT(0x92);
    INT(0x93);
    INT(0x94);
    INT(0x95);
    INT(0x96);
    INT(0x97);
    INT(0x98);
    INT(0x99);
    INT(0x9a);
    INT(0x9b);
    INT(0x9c);
    INT(0x9d);
    INT(0x9e);
    INT(0x9f);
    INT(0xa0);
    INT(0xa1);
    INT(0xa2);
    INT(0xa3);
    INT(0xa4);
    INT(0xa5);
    INT(0xa6);
    INT(0xa7);
    INT(0xa8);
    INT(0xa9);
    INT(0xaa);
    INT(0xab);
    INT(0xac);
    INT(0xad);
    INT(0xae);
    INT(0xaf);
    INT(0xb0);
    INT(0xb1);
    INT(0xb2);
    INT(0xb3);
    INT(0xb4);
    INT(0xb5);
    INT(0xb6);
    INT(0xb7);
    INT(0xb8);
    INT(0xb9);
    INT(0xba);
    INT(0xbb);
    INT(0xbc);
    INT(0xbd);
    INT(0xbe);
    INT(0xbf);
    INT(0xc0);
    INT(0xc1);
    INT(0xc2);
    INT(0xc3);
    INT(0xc4);
    INT(0xc5);
    INT(0xc6);
    INT(0xc7);
    INT(0xc8);
    INT(0xc9);
    INT(0xca);
    INT(0xcb);
    INT(0xcc);
    INT(0xcd);
    INT(0xce);
    INT(0xcf);
    INT(0xd0);
    INT(0xd1);
    INT(0xd2);
    INT(0xd3);
    INT(0xd4);
    INT(0xd5);
    INT(0xd6);
    INT(0xd7);
    INT(0xd8);
    INT(0xd9);
    INT(0xda);
    INT(0xdb);
    INT(0xdc);
    INT(0xdd);
    INT(0xde);
    INT(0xdf);
    INT(0xe0);
    INT(0xe1);
    INT(0xe2);
    INT(0xe3);
    INT(0xe4);
    INT(0xe5);
    INT(0xe6);
    INT(0xe7);
    INT(0xe8);
    INT(0xe9);
    INT(0xea);
    INT(0xeb);
    INT(0xec);
    INT(0xed);
    INT(0xee);
    INT(0xef);
    INT(0xf0);
    INT(0xf1);
    INT(0xf2);
    INT(0xf3);
    INT(0xf4);
    INT(0xf5);
    INT(0xf6);
    INT(0xf7);
    INT(0xf8);
    INT(0xf9);
    INT(0xfa);
    INT(0xfb);
    INT(0xfc);
    INT(0xfd);
    INT(0xfe);
    INT(0xff);
}*/